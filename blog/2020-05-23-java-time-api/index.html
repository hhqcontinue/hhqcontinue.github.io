<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:title" content="理解Java8中的时间API" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://hoohack.me/blog/2020-05-23-java-time-api/" />
  <link rel="stylesheet" href="/styles/main.css">
  <link rel="me" href="https://mas.to/@djyde">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.27.0/themes/prism.min.css">
  
  <title>理解Java8中的时间API | Hoohack&#39;s Blog</title>
  
</head>
<body>
  
<div>
  <div class="container mx-auto prose py-12 sm:py-24 px-12 sm:px-0">
    <div class="mb-12">
      <a class="no-underline font-bold" href="/">Hoohack&#39;s Blog</a>
    </div>
    <h1>理解Java8中的时间API</h1>
    <div class="italic text-gray-500">
      2020/05/23
    </div>
    <div>
      <p>在Java8之前，在Java开发过程中，如果要操作时间，是使用Date这个类，在Java8中新增了LocalTime、LocalDate和LocalDateTime，日期和时间的处理变得更加方便和容易。用了一段时间，刚开始每次用的时候都要上网查一波才能找到要的答案，后来认真看一下官网的API，发现也不是那么难理解，现在能够通过自己的理解找到自己想要的表达式，在这里做个小小的学习总结。</p>
<h2 id="%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%9C%89%E6%96%B0%E7%9A%84%E6%97%B6%E9%97%B4api" tabindex="-1">为什么要有新的时间API</h2>
<p>既然Date类已经存在了那么多年，为什么要花那么大的精力去做这个改动？收益是什么呢？</p>
<p>首先，因为Date类真的很难用，有很多过于Geek的设计，比如月份是从0开始，0是一月，11是十二月。好吧，我已经知道程序员是从0开始计数了，但是每次用的时候都要做各种转换，特别是跟其他输出端有交互的时候，改错一个地方就凌乱了。在新的API<code>java.time</code>里，这些都用常量表示了，不会用错，代码看起来也更加清晰。</p>
<p>&lt;!--more--&gt;</p>
<p>在业务代码中，往往有很多种需求，获取某一天的0点，获取下一天的中午时间，将当前时间往前或者往后移动几天，等等这类的需求，这些功能使用Date类配合Calendar要写好多代码，代码简洁性也不够好。</p>
<p>另外一个，Date里面的很多方法都弃用了，如果新的项目还敢用这些类，那就是给自己埋坑了，还是趁早改了为好。</p>
<p>旧的时间类<code>java.util.Date</code>和格式化类<code>SimpleDateFormatter</code>都是可变类，不是线程安全的，在多线程环境下对共享变量Date进行操作时，需要自己保证线程安全。而新的时间API<code>LocalTime</code>和<code>LocalDate</code>和格式化类<code>DateTimeFormatter</code>都是final类(不可变)且是线程安全的。</p>
<p>基于上面的这些原因，就没有理由不使用新的时间API了。</p>
<p>从一个用着习惯了很多年的工具切换到新的工具总是很不习惯，过程是痛苦的，但是结果是美好的。</p>
<h2 id="%E6%80%8E%E4%B9%88%E7%90%86%E8%A7%A3%E6%96%B0%E7%9A%84%E6%97%B6%E9%97%B4api" tabindex="-1">怎么理解新的时间API</h2>
<p>在新的时间API里，有<code>LocalTime</code>、<code>LocalDate</code>、<code>LocalDateTime</code>三个类，<code>LocalTime</code>只处理时间，无法包含日期，<code>LocalDate</code>只处理日期，无法包含时间，只有<code>LocalDateTime</code>能同时处理日期和时间。</p>
<h2 id="%E6%80%8E%E4%B9%88%E4%BD%BF%E7%94%A8%EF%BC%9F" tabindex="-1">怎么使用？</h2>
<p>如果理解了三个类的区别，那么在使用上，需要根据具体情况来处理，下面看看比较常遇到的场景。</p>
<h3 id="localdate" tabindex="-1">LocalDate</h3>
<p>只取日期，年月日。</p>
<p><strong>获取今天的日期</strong></p>
<p><code>LocalDate today = LocalDate.now();// 2020-05-20</code></p>
<p><strong>使用年月日构造一个日期</strong></p>
<p><code>LocalDate valentineDay = LocalDate.of(2020, 5, 20); // 月份和日期是从1开始</code></p>
<p><strong>指定对象，获取年、月、日、星期几</strong></p>
<pre class="language-java"><code class="language-java"><span class="token keyword">int</span> year <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">getYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token class-name">Month</span> month <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">int</span> day <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">getDayOfMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token class-name">DayOfWeek</span> dayOfWeek <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">getDayOfWeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>或者</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">int</span> year <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">ChronoField</span><span class="token punctuation">.</span><span class="token constant">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">int</span> month <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">ChronoField</span><span class="token punctuation">.</span><span class="token constant">MONTH_OF_YEAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">int</span> day <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">ChronoField</span><span class="token punctuation">.</span><span class="token constant">DAY_OF_MONTH</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">int</span> dayOfWeek <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">ChronoField</span><span class="token punctuation">.</span><span class="token constant">DAY_OF_WEEK</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="localtime" tabindex="-1">LocalTime</h3>
<p>获取时间，只会取几点几分几秒。</p>
<p><strong>初始化时间对象</strong></p>
<p><code>LocalTime localTime = LocalTime.now();</code></p>
<p><strong>使用时分秒构造一个对象</strong></p>
<p><code>LocalTime localTime = LocalTime.of(12, 0, 0);</code></p>
<p><strong>指定对象，获取时分秒</strong></p>
<pre class="language-java"><code class="language-java"><span class="token class-name">LocalTime</span> localTime <span class="token operator">=</span> <span class="token class-name">LocalTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">int</span> hour <span class="token operator">=</span> localTime<span class="token punctuation">.</span><span class="token function">getHour</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">int</span> minute <span class="token operator">=</span> localTime<span class="token punctuation">.</span><span class="token function">getMinute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">int</span> second <span class="token operator">=</span> localTime<span class="token punctuation">.</span><span class="token function">getSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">int</span> hour <span class="token operator">=</span> localTime<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">ChronoField</span><span class="token punctuation">.</span><span class="token constant">HOUR_OF_DAY</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">int</span> minute <span class="token operator">=</span> localTime<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">ChronoField</span><span class="token punctuation">.</span><span class="token constant">MINUTE_OF_HOUR</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">int</span> second <span class="token operator">=</span> localTime<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">ChronoField</span><span class="token punctuation">.</span><span class="token constant">SECOND_OF_MINUTE</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="localdatetime" tabindex="-1">LocalDateTime</h3>
<p>获取日期+时间，年月日+时分秒，含义等于LocalDate+LocalTime</p>
<p><strong>创建时间对象</strong></p>
<p><code>LocalDateTime localDateTime = LocalDateTime.now();</code></p>
<p><strong>使用LocalDate结合LocalTime构造时间对象</strong></p>
<pre class="language-java"><code class="language-java"><span class="token class-name">LocalDateTime</span> localDateTime <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>localData<span class="token punctuation">,</span> localTime<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token class-name">LocalDateTime</span> localDateTime <span class="token operator">=</span> localDate<span class="token punctuation">.</span><span class="token function">atTime</span><span class="token punctuation">(</span>localTime<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token class-name">LocalDateTime</span> localDateTime <span class="token operator">=</span> localTime<span class="token punctuation">.</span><span class="token function">atDate</span><span class="token punctuation">(</span>localDate<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><strong>通过LocalDateTime获取LocalDate和LocalTime</strong></p>
<pre class="language-java"><code class="language-java"><span class="token class-name">LocalDate</span> localDate <span class="token operator">=</span> localDateTime<span class="token punctuation">.</span><span class="token function">toLocalDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token class-name">LocalTime</span> localDate <span class="token operator">=</span> localDateTime<span class="token punctuation">.</span><span class="token function">toLocalTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="instant" tabindex="-1">Instant</h2>
<p>这个类是表示时间轴上的某一个时刻的时间点。从<strong>1970-01-01 00:00:00</strong>这个时间开始计算，主要用于获取时间戳，与<code>System.currentTimeMillis()</code>（精确到毫秒）类似，但是Instant类可以精确到纳秒。</p>
<p><strong>创建Instant对象</strong></p>
<p><code>Instant instant = Instant.now();</code></p>
<p><strong>使用时间戳创建Instant对象</strong></p>
<p><code>Instant instant = Instant.ofEpochSecond(100, 100000);</code></p>
<p><strong>获取秒数和毫秒</strong></p>
<pre class="language-java"><code class="language-java">instant<span class="token punctuation">.</span><span class="token function">getEpochSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>instant<span class="token punctuation">.</span><span class="token function">getEpochMill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="%E4%B8%BE%E4%BE%8B%E5%AD%90%E5%8A%A0%E6%B7%B1%E5%8D%B0%E8%B1%A1" tabindex="-1">举例子加深印象</h2>
<p>介绍了这几个类的基本API后，再通过实现某些具体的需求来加深印象。</p>
<h3 id="%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%97%B6%E9%97%B4%E6%88%B3" tabindex="-1">获取当前时间戳</h3>
<pre class="language-java"><code class="language-java"><span class="token comment">// 获取当前时间对象->设置时->转换成时间戳</span><br><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">getCurrentSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	<span class="token keyword">return</span> <span class="token class-name">Instant</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">atZone</span><span class="token punctuation">(</span><span class="token class-name">ZoneOffset</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"+8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEpochSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<h3 id="%E8%8E%B7%E5%8F%96%E5%BD%93%E5%A4%A9%E9%9B%B6%E7%82%B9%2F%E7%BB%93%E6%9D%9F%E6%97%B6%E9%97%B4%E7%9A%84%E6%97%B6%E9%97%B4%E6%88%B3" tabindex="-1">获取当天零点/结束时间的时间戳</h3>
<pre class="language-java"><code class="language-java"><span class="token comment">// 使用日期和时间构造日期时间对象->指定时区转换成时间戳</span><br><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">getTodayStartTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	<span class="token keyword">return</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">LocalTime</span><span class="token punctuation">.</span><span class="token constant">MIN</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEpochSecond</span><span class="token punctuation">(</span><span class="token class-name">ZoneOffset</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"+8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">getTodayEndTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">LocalTime</span><span class="token punctuation">.</span><span class="token constant">MAX</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEpochSecond</span><span class="token punctuation">(</span><span class="token class-name">ZoneOffset</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"+8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br></code></pre>
<h3 id="%E8%8E%B7%E5%8F%96%E5%89%8D%E4%B8%80%E5%A4%A9%E9%9B%B6%E7%82%B9" tabindex="-1">获取前一天零点</h3>
<pre class="language-java"><code class="language-java"><span class="token comment">// 使用日期和时间构造日期时间对象->修改日期->指定时区转换成时间戳</span><br><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">getYesterdayStartTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	<span class="token keyword">return</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">LocalTime</span><span class="token punctuation">.</span><span class="token constant">MIN</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">minusDays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEpochSecond</span><span class="token punctuation">(</span><span class="token class-name">ZoneOffset</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"+8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<h3 id="%E6%A0%B9%E6%8D%AE%E6%97%B6%E9%97%B4%E6%88%B3%E8%8E%B7%E5%8F%96%E6%97%B6%E9%97%B4%E6%88%B3%E8%A1%A8%E7%A4%BA%E7%9A%84%E6%97%B6%E9%97%B4%E5%BD%93%E5%A4%A90%E7%82%B9" tabindex="-1">根据时间戳获取时间戳表示的时间当天0点</h3>
<pre class="language-java"><code class="language-java"><span class="token comment">// 使用时间戳构造日期时间对象->修改日期->指定时区转换成时间戳</span><br><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">getDayStartTime</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	<span class="token keyword">return</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">LocalTime</span><span class="token punctuation">.</span><span class="token constant">MIN</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">minusDays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEpochSecond</span><span class="token punctuation">(</span><span class="token class-name">ZoneOffset</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"+8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<h3 id="%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E6%9C%88%E5%88%9D%E7%AC%AC%E4%B8%80%E5%A4%A9" tabindex="-1">判断是否月初第一天</h3>
<pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">isFirstDayOfMonth</span><span class="token punctuation">(</span><span class="token class-name">String</span> ymd<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token class-name">LocalDate</span> localDate <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>ymd<span class="token punctuation">,</span> <span class="token class-name">DateTimeFormatter</span><span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">"yyyyMMdd"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> localDate<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>localDate<span class="token punctuation">.</span><span class="token function">withDayOfMonth</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<h2 id="%E6%80%BB%E7%BB%93" tabindex="-1">总结</h2>
<p><img src="https://www.hoohack.me/assets/images/2020/05/understand-java-8-time.png" alt="理解Java8中的时间API"></p>
<p>Java新的时间API很强大，这里只能举几个自己遇到比较多的场景给大家介绍，所讲的只是最基础最皮毛的东西，要熟练的掌握所有的细节，还是需要去看看API或源码的实现，然后在平时具体的需求场景中慢慢积累。</p>
<p>原创文章，文笔有限，才疏学浅，文中若有不正之处，万望告知。</p>
<p>如果本文对你有帮助，请点个赞吧，谢谢</p>
<p>更多精彩内容，请关注个人公众号。</p>
<p><img src="https://www.hoohack.me/assets/images/qrcode.jpg" alt=""></p>

    </div>
    <hr />
      <div class="text-sm text-center">
        评论和交流请发送邮件到 hoohackhu@gmail.com
      </div>
      <hr />
    <div class="text-center">
</div>
    <footer class="text-sm py-12 text-gray-500 text-center">
  Hoohack's Blog since 2014
</footer>
  </div>

</div>



</body>
</html>
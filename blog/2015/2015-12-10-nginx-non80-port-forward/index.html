<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:title" content="【nginx配置】nginx做非80端口转发" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://hoohack.me/blog/2015/2015-12-10-nginx-non80-port-forward/" />
  <link rel="stylesheet" href="/styles/main.css">
  <link rel="me" href="https://mas.to/@djyde">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.27.0/themes/prism.min.css">
  
  <title>【nginx配置】nginx做非80端口转发 | Hoohack&#39;s Blog</title>
  
</head>
<body>
  
<div>
  <div class="container mx-auto prose py-12 sm:py-24 px-12 sm:px-0">
    <div class="mb-12">
      <a class="no-underline font-bold" href="/">Hoohack&#39;s Blog</a>
    </div>
    <h1>【nginx配置】nginx做非80端口转发</h1>
    <div class="italic text-gray-500">
      2015/12/10
    </div>
    <div>
      <h2 id="%E4%B8%80%E4%B8%AA%E5%9C%BA%E6%99%AF" tabindex="-1">一个场景</h2>
<p>最近在使用PHP重写一个使用JAVA写的项目，因为需要查看之前的项目，所以要在本地搭建一个Tomcat来跑JAVA的项目。搭建成功后，因为Tomcat监听的端口是8080，因此，访问的URL前缀是<code>localhost:8080</code>，每次访问项目的时候都要先输入这一串内容，感觉比较繁杂，所以想着将其变成<code>localhost</code>来访问，但是这样的话就是访问80端口了，要达到目的，就得做端口转发。笔者见识比较少，暂时想到的是使用Nginx/Apache等程序做转发。如果有更好的方案，欢迎指教。</p>
<h2 id="%E5%A2%9E%E5%8A%A0nginx%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA" tabindex="-1">增加Nginx虚拟主机</h2>
<p><img src="http://7u2eqw.com1.z0.glb.clouddn.com/nginx%E9%85%8D%E7%BD%AE.jpg" alt="nginx配置"></p>
<p>要做Nginx的转发，当然就要对Nginx做配置。可以通过添加虚拟主机配置来增强Nginx的功能。首先看看Nginx的配置文件，笔者的Nginx文件是在<code>/etc/nginx/nginx.conf</code>。从上图可以看到Nginx在最后引入了<code>vhosts.d</code>目录下的配置文件。那么就要在<code>/etc/nginx/vhosts.d</code>目录下创建以.conf为后缀的文件（如果该目录不存在需要自己创建）。</p>
<h2 id="nginx%E5%81%9A%E9%9D%9E80%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91" tabindex="-1">Nginx做非80端口转发</h2>
<p>要做转发，可以使用Nginx的<code>proxy_pass</code>配置项。Nginx监听80端口，接收到请求之后就会转发到要转发的URL。具体的配置如下:</p>
<p>server {
server_name <a href="http://www.test.com">www.test.com</a>
listen 80;</p>
<p>location / {
proxy_pass <a href="http://127.0.0.1:8080">http://127.0.0.1:8080</a>;
}
}</p>
<p>是的，就是这么简单就可以了。这是配置端口转发的核心。</p>
<p>但是，当遇到需要获取真实IP的业务时，还需要添加关于真实IP的配置：</p>
<p>server {
server_name <a href="http://www.test.com">www.test.com</a>
listen 80;</p>
<p>location / {
proxy_pass <a href="http://127.0.0.1:8080">http://127.0.0.1:8080</a>;
proxy_set_header Host $host:80;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
}
}</p>
<p><code>proxy_set_header</code>这句配置是改变http的请求头。而Host是请求的主机名，<code>X-Real-IP</code>是请求的真实IP，<code>X-Forwarded-For</code>表示请求是由谁发起的。</p>
<h2 id="%E5%B0%8F%E7%BB%93" tabindex="-1">小结</h2>
<p>这次的配置可能对大部分人来说都很简单，但是笔者刚接触Nginx配置这一块，因此记录下来，分享给有需要的人。如有建议和批评，欢迎指出。通过这次的学习发现，Nginx的配置是很值得学习的。</p>

    </div>
    <hr />
      <div class="text-sm text-center">
        评论和交流请发送邮件到 hoohackhu@gmail.com
      </div>
      <hr />
    <div class="text-center">
</div>
    <footer class="text-sm py-12 text-gray-500 text-center">
  Hoohack's Blog since 2014
</footer>
  </div>

</div>



</body>
</html>